<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>Number Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<div class="page-wrapper">
<nav class="navbar navbar-expand-md navbar-dark">
  <div class="container-fluid">
  <a class="navbar-brand" href="/">Number Predictor</a>

  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#myNavbar" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

    <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="navbar-nav ms-auto">                   
            <li><a class="nav-item me-3" href="statistics">Statistics</a></li>
            <li><a class="nav-item me-3" href="history">History</a></li>
        </ul>
    </div>

  </div>
</nav>


    <h1 id="homepage_heading"><b>Number Predictor</b></h1>

    <div class="info" style="text-align: center; margin-top: 10px;">
        <p>Draw a digit (0-9) on the canvas below. Double click to clear the canvas.</p>
    </div>

    <div class="canvas-container" style="text-align: center; margin-top: 20px">
    <canvas id="canvas" width="280" height="280"></canvas>
    </div>

    <div class="homepage_predict_button">
        <button type="button" id="predict-button" class="btn rounded">
            Predict
        </button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        canvas.addEventListener('mousedown', () => {
            drawing = true;
            ctx.beginPath();
        });

        canvas.addEventListener('mouseup', () => {
            drawing = false;
            ctx.beginPath();
        });

        canvas.addEventListener('mousemove', (event) => {
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            ctx.lineWidth = 15;
            ctx.lineCap = 'round';
            ctx.strokeStyle = 'black';;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        });

        canvas.addEventListener('dblclick', () => {
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        });
    </script>

    <script>
        document.getElementById('predict-button').addEventListener('click', () => {
            const imageData = canvas.toDataURL();
            //document.getElementById('imageData').value = imageData;

            fetch('/predict', {
                method: 'POST',
                body: new URLSearchParams({ image: imageData }),
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('predicted-number').textContent = data.prediction;
                document.getElementById('confidence-score').textContent = 
                    (data.confidence * 100).toFixed(2) + '%';
                    
                document.getElementById('feedback-section').style.display = 'block';
                document.getElementById('predicted_label_input').value = data.prediction;
                document.getElementById('confidence_input').value = data.confidence;
                document.getElementById('image_array_input').value = data.image_array;
            })
            .catch(err => console.error(err));
        });
    </script>

    <div class="prediction">
        <h2>Predicted Number: <span id="predicted-number">?</span></h2>
    </div>

    <div class="confidence">
        <h3>Confidence: <span id="confidence-score">?</span></h3>
    </div>

    <div id="feedback-section" class="feedback" style="display:none; text-align:center; margin-top:30px;">
        <h4>Was this prediction correct?</h4>
        <form method="POST" action="/feedback" style="display: inline-block; margin-top: 10px;">
            <input type="hidden" id="image_array_input" name="image_array">
            <input type="hidden" id="predicted_label_input" name="predicted_label">
            <input type="hidden" id="confidence_input" name="confidence">

            <div class="mb-3">
                <label for="true_label" class="form-label">Enter the correct number (0-9):</label>
                <input type="number" name="true_label" id="true_label" min="0" max="9" required class="form-control" style="width: 100px; margin: 0 auto;">
            </div>

            <button id="submit-feedback" type="submit" class="btn rounded">
                Submit Feedback 
            </button>
        </form>
    </div>

    <div id="reset-section" class="reset">
        <button id="reset-button" class="btn rounded">Reset</button>
        <script>
            document.getElementById('reset-button').addEventListener('click', () => {
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                document.getElementById('predicted-number').textContent = '?';
                document.getElementById('confidence-score').textContent = '?';

                const feedbackSection = document.getElementById('feedback-section');
                if (feedbackSection) {
                    feedbackSection.style.display = 'none';
                }
            });
        </script>
    </div>

    <div class="footer">
        <footer><p>&copy; 2025 Number Predictor by Elaine Grundei and Hannah Kraft</p></footer>
    </div>
</div>
</body>
</html>

