<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Number Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<div class="page-wrapper">
<nav class="navbar navbar-expand-md navbar-dark">
  <div class="container-fluid">
  <a class="navbar-brand" href="/">Number Predictor</a>

  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#myNavbar" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

    <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="navbar-nav ms-auto">                   
            <li><a id="active" class="nav-item me-3" href="statistics">Statistics</a></li>
            <li><a class="nav-item me-3" href="history">History</a></li>
        </ul>
    </div>
  </div>
</nav>

<div class="content">
    <h2 id="statistics-heading"><b>Statistics</b></h2>
    <div class="statistics-container">
        <p id="sub_heading">Select Model:
          <select id="modelSelect" class="form-select">
              <option value="all" {% if selected_model == 'all' %}selected{% endif %}>All Models</option>
              {% for model in models %}
              <option value="{{ model }}" {% if selected_model == model %}selected{% endif %}>{{ model }}</option>
              {% endfor %}
          </select>
        </p>
        <p id="sub_heading">Total Predictions Made: {{ total_predictions }}</p>
        <p id="sub_heading">Correct Predictions: {{ correct_predictions }}</p>
        <p id="sub_heading">Accuracy: {{ accuracy }}%</p>
    </div>

    <div class="charts-container">
        <h4 id="chart_heading">Predictions per Digit</h4>
        <canvas id="predictionsChart" width="400" height="200"></canvas>

        <h4 id="chart_heading" style="margin-top: 30px;">Accuracy per Digit</h4>
        <canvas id="accuracyChart" width="400" height="200"></canvas>
    </div>
</div>

<script>
  document.getElementById('modelSelect').addEventListener('change', () => {
    const selectedModel = document.getElementById('modelSelect').value;
    window.location.href = `/statistics?model=${selectedModel}`;
  });

  const digits = [...Array(10).keys()].map(String);

  {% if selected_model == 'all' %}
  const baseColor = '103,49,71'; // RGB von #673147
  const predictionsData = {{ predictions_per_model|tojson }};
  const accuracyData = {{ accuracy_per_model|tojson }};

  // ðŸ”¹ Debug: prÃ¼fen, welche Keys ankommen
  console.log("accuracyData:", accuracyData);
  Object.keys(accuracyData).forEach(model => {
      console.log("Model:", model, accuracyData[model], Object.keys(accuracyData[model]));
  });

  function getColor(index, total) {
      const opacity = 0.5 + 0.5 * (index / Math.max(total-1, 1));
      return `rgba(${baseColor}, ${opacity})`;
  }

  // ðŸ”¹ Predictions Chart
  const datasetsPred = [];
  const modelNames = Object.keys(predictionsData);
  modelNames.forEach((model, i) => {
      datasetsPred.push({
          label: model,
          data: digits.map(d => predictionsData[model][d] !== undefined ? predictionsData[model][d] : 0),
          backgroundColor: getColor(i, modelNames.length)
      });
  });

  const ctx1 = document.getElementById('predictionsChart').getContext('2d');
  new Chart(ctx1, {
      type: 'bar',
      data: { labels: digits, datasets: datasetsPred },
      options: { 
          responsive: true,
          scales: {
              x: { stacked: true },
              y: { stacked: true, beginAtZero: true }
          }
      }
  });

  // ðŸ”¹ Accuracy Chart
  const datasetsAcc = [];
  modelNames.forEach((model, i) => {
      datasetsAcc.push({
          label: model,
          data: digits.map(d => accuracyData[model][d] !== undefined ? accuracyData[model][d] : 0),
          backgroundColor: getColor(i, modelNames.length)
      });
  });

  const ctx2 = document.getElementById('accuracyChart').getContext('2d');
  new Chart(ctx2, {
      type: 'bar',
      data: { labels: digits, datasets: datasetsAcc },
      options: {
          responsive: true,
          scales: { y: { beginAtZero: true, max: 100 } }
      }
  });

  {% else %}
  // Single Model
  const predictionsData = {{ predictions_per_digit|tojson }};
  const accuracyData = {{ accuracy_per_digit|tojson }};

  const ctx1 = document.getElementById('predictionsChart').getContext('2d');
  new Chart(ctx1, {
      type: 'bar',
      data: { 
          labels: digits, 
          datasets: [{ label: '{{ selected_model }}', data: digits.map(d => predictionsData[d] || 0), backgroundColor: 'rgba(103,49,71,0.6)' }] 
      },
      options: { scales: { y: { beginAtZero: true } } }
  });

  const ctx2 = document.getElementById('accuracyChart').getContext('2d');
  new Chart(ctx2, {
      type: 'bar',
      data: { 
          labels: digits, 
          datasets: [{ label: '{{ selected_model }}', data: digits.map(d => accuracyData[d] || 0), backgroundColor: 'rgba(103,49,71,0.6)' }] 
      },
      options: { scales: { y: { beginAtZero: true, max: 100 } } }
  });
  {% endif %}
</script>


<div class="footer">
    <footer><p>&copy; 2025 Number Predictor by Elaine Grundei and Hannah Kraft</p></footer>
</div>

</div>
</body>
</html>
